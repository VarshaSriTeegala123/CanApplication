
pipeline {
  agent any
  tools {
  nodejs "NODE"
  maven "maven3.6.3"
  }
  environment {
        buildnumber = "${BUILD_NUMBER}"
        jobName    = "${env.JOB_NAME}"
        branchName = "${BRANCH_NAME}"
    }
  stages{

 
  
     
    stage('SCM Checkout'){
	steps {
         script {
      // Checkout the repository and save the resulting metadata
      def scmVars = checkout([
        $class: 'GitSCM'
      ])
	    checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'GithubCredentails', url: 'https://github.com/mudaliar20/CanApplication.git']]])
	  env.GIT_COMMIT = scmVars.GIT_COMMIT
         
          echo "GIT_COMMIT=${env.GIT_COMMIT}" 
           echo "${buildnumber}" 
           echo "${jobName}" 
         // echo getGitBranchName() 
          echo env.BRANCH_NAME 
         // echo determineRepoName "echo determineRepoName()" 
         // echo determineRepoURL "echo determineRepoURL()" 
    }
	}
  }
  
  stage('Test') {
	 steps{
	     sh ' rm -rf *.properties'
	    // sh  "echo demo=${BUILD_NUMBER} >> ${env.JOB_NAME}-${env.BUILD_NUMBER}.properties"
        // sh "echo  demo1=${env.WORKSPACE} >> ${env.JOB_NAME}-${env.BUILD_NUMBER}.properties"
         sh  '''
         "echo pipelineName=${jobName} >> variable.properties"
         "echo buildNumber=${buildnumber} >> variable.properties"
         "echo buildNumber=${env.BRANCH_NAME} >> variable.properties"
         "echo determineRepoName='echo determineRepoName()' >> variable.properties"
         "echo determineRepourl='echo determineRepoURL()' >> variable.properties"
'''
    }
     }
}
}

String determineRepoName() {
    return scm.getUserRemoteConfigs()[0].getUrl().tokenize('/')[3].split("\\.")[0]
}
String determineRepoURL() {
    return scm.getUserRemoteConfigs()[0].getUrl()
}
String getGitBranchName() {
    return scm.branches[0].name.tokenize("*")[0].split("\\/")[1]
}

